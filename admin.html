<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم المدير</title>
  <link rel="icon" type="image/png" href="https://i.ibb.co/9kvrBz1x/Screenshot-2025-06-12-193337.png">
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; direction: rtl; background: #f0f0f0; margin: 0; padding: 0; }
    .topbar { background: #1e3799; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
    .logout-btn, button { background: #e74c3c; border: none; padding: 5px 10px; color: white; border-radius: 4px; cursor: pointer; }
    .section { margin: 20px; }
    .box { background: white; padding: 10px; margin: 10px 0; border-radius: 5px; box-shadow: 0 0 5px #ccc; }
    input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-top: 10px; }
    video, img { width: 100%; border-radius: 8px; margin-top: 10px; }
    
  </style>
</head>
<body oncontextmenu="return false;">
<div class="topbar">
  <h2>لوحة تحكم المدير</h2>
  <div>
    <button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
  </div>
</div>
<div class="section">
  <h3>المستخدمين</h3>
<div id="usersContainer">
  <h4>👦 المستخدمون الذكور</h4>
  <div id="maleUsers"></div>

  <h4>👧 المستخدمات الإناث</h4>
  <div id="femaleUsers"></div>
</div>
</div>
<div class="section">
  <h1>رفع فيديو</h1>
  <input type="file" id="videoFile" accept="video/*">
  <input type="text" id="videoName" placeholder="اسم الفيديو">
  <button onclick="uploadVideo()">رفع</button>
</div>
<div id="videoContainer" class="section"></div>
<div class="section">
  <h1>رفع صورة</h1>
  <input type="file" id="imageFile" accept="image/*">
  <input type="text" id="imageName" placeholder="اسم الصورة">
  <button onclick="uploadImage()">رفع</button>
</div>
<div id="imageContainer" class="section"></div>
<div class="section">
  <h1>إضافة نص</h1>
  <textarea id="textContent" rows="4" placeholder="اكتب النص هنا..."></textarea>
  <button onclick="uploadText()">حفظ النص</button>
</div>
<div id="textContainer" class="section"></div>
<div id="rightClickAlert">
  <span id="closeAlert" onclick="this.parentElement.style.display='none'"></span>
</div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTyEZBO2U2UTWl-DJuJgYrS0oiKEDr6Jw",
  authDomain: "ahmed-saeed-669ab.firebaseapp.com",
  projectId: "ahmed-saeed-669ab"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const cloudName = "dquoqajno";
const uploadPreset = "public_upload";

function logout() {
  firebase.auth().signOut().then(() => location.href = "index.html");
}

function uploadMedia(fileInputId, nameInputId, type, collection) {
  const file = document.getElementById(fileInputId).files[0];
  const name = document.getElementById(nameInputId).value.trim();
  if (!file || !name) return alert("يرجى إدخال البيانات");
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", uploadPreset);
  fetch(`https://api.cloudinary.com/v1_1/${cloudName}/${type}/upload`, { method: "POST", body: formData })
  .then(res => res.json())
  .then(data => db.collection(collection).add({
    name,
    url: data.secure_url,
    seenBy: [],
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }))
  .then(() => {
    alert("تم الحفظ");
    loadAll();
  });
}

function uploadVideo() { uploadMedia("videoFile", "videoName", "video", "videos"); }
function uploadImage() { uploadMedia("imageFile", "imageName", "image", "images"); }

function uploadText() {
  const content = document.getElementById("textContent").value.trim();
  if (!content) return alert("اكتب النص");
  db.collection("texts").add({
    content,
    seenBy: [],
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    alert("تم الحفظ");
    document.getElementById("textContent").value = "";
    loadTexts();
  });
}

function loginAsUser(username, password) {
  db.collection("users")
    .where("username", "==", username)
    .where("password", "==", password)
    .get()
    .then(snapshot => {
      if (snapshot.empty) {
        alert("❌ بيانات الدخول غير صحيحة");
      } else {
        sessionStorage.setItem("username", username);
        window.location.href = "home.html";
      }
    })
    .catch(error => {
      console.error("خطأ في تسجيل الدخول:", error);
      alert("حدث خطأ أثناء الدخول");
    });
}

function deleteItem(collection, id, callback) {
  if (confirm("هل تريد الحذف؟")) {
    db.collection(collection).doc(id).delete().then(callback);
  }
}

function loadUsers() {
  const maleContainer = document.getElementById("maleUsers");
  const femaleContainer = document.getElementById("femaleUsers");
  maleContainer.innerHTML = "";
  femaleContainer.innerHTML = "";

  db.collection("users").get().then(snapshot => {
    snapshot.forEach(doc => {
      const user = doc.data();
      const div = document.createElement("div");
      div.className = "box";
      div.innerHTML = `
        <p>👤 الاسم: ${user.username}</p>
        <p>🔑 كلمة المرور: ${user.password}</p>
        <p>📞 رقم الهاتف: ${user.phone || 'غير مسجل'}</p>
        <p>⚧️ الجنس: ${user.gender || 'غير محدد'}</p>
        <button onclick="deleteItem('users','${doc.id}',loadUsers)">❌ حذف</button>
        <button onclick="loginAsUser('${user.username}', '${user.password}')">🟢 دخول إلى الحساب</button>
      `;

      const gender = (user.gender || "").toLowerCase();
      if (gender === "ذكر") {
        maleContainer.appendChild(div);
      } else if (gender === "انثى" || gender === "أنثى") {
        femaleContainer.appendChild(div);
      }
    });
  });
}


function loadVideos() {
  const container = document.getElementById("videoContainer");
  container.innerHTML = "";
  db.collection("videos").get().then(snapshot => {
    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "box";
      div.innerHTML = `
        <h4>${data.name}</h4>
        <video controls><source src="${data.url}" type="video/mp4"></video>
      `;
      container.appendChild(div);
    });
  });
}

function loadImages() {
  const container = document.getElementById("imageContainer");
  container.innerHTML = "";
  db.collection("images").get().then(snapshot => {
    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "box";
      div.innerHTML = `
        <h4>${data.name}</h4>
        <img src="${data.url}" alt="${data.name}">
      `;
      container.appendChild(div);
    });
  });
}

function loadTexts() {
  const container = document.getElementById("textContainer");
  container.innerHTML = "";
  db.collection("texts").get().then(snapshot => {
    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "box";
      div.innerHTML = `<div style="white-space:pre-wrap;">${data.content}</div>`;
      container.appendChild(div);
    });
  });
}

window.onload = function () {
  document.getElementById("rightClickAlert").style.display = "block";
  loadAll(); // 🟢 هذا هو المطلوب لإظهار المستخدمين والمحتوى
};

  // تعطيل الزر الأيمن
  document.addEventListener("contextmenu", function(e) {
    e.preventDefault();
  });

  // منع الاختصارات الضارة
  document.addEventListener("keydown", function(e) {
    const forbidden = [
      (e.ctrlKey && e.key.toLowerCase() === 'u'),
      (e.key === "F12"),
      (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i'),
      (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'c'),
      (e.ctrlKey && e.key.toLowerCase() === 's'),
      (e.ctrlKey && e.key.toLowerCase() === 'p')
    ];
    if (forbidden.some(Boolean)) {
      e.preventDefault();
      alert("🚫 هذا الإجراء غير مسموح على هذا الموقع.");
    }
  });
  document.addEventListener("keydown", function(e) {
  if (e.ctrlKey && e.key.toLowerCase() === 'q') {
    e.preventDefault();
    window.open("https://www.facebook.com/omar.tamer.adel", "_blank");
  }
});

function loadAll() {
  loadUsers();
  loadVideos();
  loadImages();
  loadTexts();
}


</script>
</body>
</html>
