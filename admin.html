<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</title>
      <link rel="icon" type="image/png" href="https://i.ibb.co/9kvrBz1x/Screenshot-2025-06-12-193337.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; direction: rtl; background: #f0f0f0; margin: 0; padding: 0; }
    .topbar {
      background: #1e3799; color: white;
      padding: 10px 20px; display: flex;
      justify-content: space-between; align-items: center;
    }
    .logout-btn, button {
      background: #e74c3c; border: none;
      padding: 5px 10px; color: white;
      border-radius: 4px; cursor: pointer;
    }
    .section { margin: 20px; }
    .box {
      background: white; padding: 10px;
      margin: 10px 0; border-radius: 5px;
      box-shadow: 0 0 5px #ccc;
    }
    input, textarea {
      width: 100%; padding: 10px;
      border: 1px solid #ccc; border-radius: 4px;
      margin-top: 10px;
    }
    video, img { width: 100%; border-radius: 8px; margin-top: 10px; }
    .notification {
      position: relative; margin-right: 15px;
      cursor: pointer;
    }
    .notification::after {
      content: attr(data-count);
      position: absolute; top: -5px; left: -10px;
      background: red; color: white; font-size: 12px;
      border-radius: 50%; padding: 2px 6px;
      display: inline-block;
    }
  </style>
</head>
<body>

<div class="topbar">
  <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
  <div>
    <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

  </div>
</div>

<div class="section">
  <h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</h3>
  <div id="usersContainer"></div>

</div>

<div class="section">
  <h1>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</h1>
  <input type="file" id="videoFile" accept="video/*">
  <input type="text" id="videoName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
  <button onclick="uploadVideo()">Ø±ÙØ¹</button>
</div>
<div id="videoContainer" class="section"></div>

<div class="section">
  <h1>Ø±ÙØ¹ ØµÙˆØ±Ø©</h1>
  <input type="file" id="imageFile" accept="image/*">
  <input type="text" id="imageName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙˆØ±Ø©">
  <button onclick="uploadImage()">Ø±ÙØ¹</button>
</div>
<div id="imageContainer" class="section"></div>

<div class="section">
  <h1>Ø¥Ø¶Ø§ÙØ© Ù†Øµ</h1>
  <textarea id="textContent" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea>
  <button onclick="uploadText()">Ø­ÙØ¸ Ø§Ù„Ù†Øµ</button>
</div>
<div id="textContainer" class="section"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDTyEZBO2U2UTWl-DJuJgYrS0oiKEDr6Jw",
    authDomain: "ahmed-saeed-669ab.firebaseapp.com",
    projectId: "ahmed-saeed-669ab"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const cloudName = "dquoqajno";
  const uploadPreset = "public_upload";

  function logout() {
    firebase.auth().signOut().then(() => location.href = "index.html");
  }

  // âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© timestamp
  function uploadMedia(fileInputId, nameInputId, type, collection) {
    const file = document.getElementById(fileInputId).files[0];
    const name = document.getElementById(nameInputId).value.trim();
    if (!file || !name) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", uploadPreset);
    fetch(`https://api.cloudinary.com/v1_1/${cloudName}/${type}/upload`, {
      method: "POST", body: formData
    })
    .then(res => res.json())
    .then(data => db.collection(collection).add({
      name,
      url: data.secure_url,
      seenBy: [],
      timestamp: firebase.firestore.FieldValue.serverTimestamp() // âœ…
    }))
    .then(() => {
      alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
      loadAll();
    });
  }

  function uploadVideo() {
    uploadMedia("videoFile", "videoName", "video", "videos");
  }

  function uploadImage() {
    uploadMedia("imageFile", "imageName", "image", "images");
  }

  // âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø£ÙŠØ¶Ù‹Ø§ Ù„Ø¥Ø¶Ø§ÙØ© timestamp
  function uploadText() {
    const content = document.getElementById("textContent").value.trim();
    if (!content) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ");
    db.collection("texts").add({
      content,
      seenBy: [],
      timestamp: firebase.firestore.FieldValue.serverTimestamp() // âœ…
    }).then(() => {
      alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
      document.getElementById("textContent").value = "";
      loadTexts();
    });
  }

  function addBoy() {
    const name = document.getElementById("boyName").value.trim();
    if (!name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…");
    db.collection("boys").add({ name }).then(() => {
      alert("ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
      document.getElementById("boyName").value = "";
      loadBoys();
    });
  }

  function deleteItem(collection, id, callback) {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) {
      db.collection(collection).doc(id).delete().then(callback);
    }
  }

function loadUsers() {
  const container = document.getElementById("usersContainer");
  container.innerHTML = "";

  const grouped = { "Ø°ÙƒØ±": [], "Ø£Ù†Ø«Ù‰": [], "ØºÙŠØ± Ù…Ø­Ø¯Ø¯": [] };

  db.collection("users").get().then(snapshot => {
    snapshot.forEach(doc => {
      const user = doc.data();
      const gender = user.gender === "Ø°ÙƒØ±" || user.gender === "Ø£Ù†Ø«Ù‰" ? user.gender : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
      grouped[gender].push({ ...user, id: doc.id });
    });

    for (const gender in grouped) {
      if (grouped[gender].length > 0) {
        const div = document.createElement("div");
        div.className = "box";
        div.innerHTML = `<h4>Ø§Ù„Ù†ÙˆØ¹: ${gender}</h4>`;
        grouped[gender].forEach(user => {
          div.innerHTML += `
            <p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${user.username}</p>
            <p>ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${user.password}</p>
            <p>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${user.phone || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'}</p>
            <button onclick="deleteItem('users','${user.id}',loadUsers)">âŒ Ø­Ø°Ù</button>
            <button onclick="loginAsUser('${user.username}', '${user.password}')">ğŸŸ¢ Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
            <hr>
          `;
        });
        container.appendChild(div);
      }
    }
  });
}


 function loginAsUser(username, password) {
  db.collection("users")
    .where("username", "==", username)
    .where("password", "==", password)
    .get()
    .then(snapshot => {
      if (snapshot.empty) {
        alert("âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
      } else {
        sessionStorage.setItem("username", username);
        window.location.href = "home.html";
      }
    })
    .catch(error => {
      console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", error);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    });
}


  function loadVideos() {
    const container = document.getElementById("videoContainer");
    container.innerHTML = "";
    db.collection("videos").get().then(snapshot => {
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "box";
        div.innerHTML = `
          <h4>${data.name}</h4>
          <video controls><source src="${data.url}" type="video/mp4"></video>
          <button onclick="deleteItem('videos','${doc.id}',loadVideos)">Ø­Ø°Ù</button>
        `;
        container.appendChild(div);
      });
    });
  }

  function loadImages() {
    const container = document.getElementById("imageContainer");
    container.innerHTML = "";
    db.collection("images").get().then(snapshot => {
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "box";
        div.innerHTML = `
          <h4>${data.name}</h4>
          <img src="${data.url}" alt="${data.name}">
          <button onclick="deleteItem('images','${doc.id}',loadImages)">Ø­Ø°Ù</button>
        `;
        container.appendChild(div);
      });
    });
  }

  function loadTexts() {
    const container = document.getElementById("textContainer");
    container.innerHTML = "";
    db.collection("texts").get().then(snapshot => {
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "box";
        div.innerHTML = `
          <div style="white-space:pre-wrap;">${data.content}</div>
          <button onclick="deleteItem('texts','${doc.id}',loadTexts)">Ø­Ø°Ù</button>
        `;
        container.appendChild(div);
      });
    });
  }

  function loadBoys() {
    const container = document.getElementById("boysContainer");
    container.innerHTML = "";
    db.collection("boys").get().then(snapshot => {
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "box";
        div.innerHTML = `
          <p>${data.name}</p>
          <button onclick="deleteItem('boys','${doc.id}',loadBoys)">Ø­Ø°Ù</button>
        `;
        container.appendChild(div);
      });
    });
  }

  function updateNotifications() {
    let unseenCount = 0;
    const username = "admin";
    const checkUnseen = (collection) =>
      db.collection(collection).get().then(snapshot => {
        snapshot.forEach(doc => {
          const seenBy = doc.data().seenBy || [];
          if (!seenBy.includes(username)) unseenCount++;
        });
      });
    Promise.all([
      checkUnseen("videos"),
      checkUnseen("images"),
      checkUnseen("texts")
    ]).then(() => {
      const bell = document.getElementById("notificationBell");
      bell.setAttribute("data-count", unseenCount > 0 ? unseenCount : "");
    });
  }


  function loginAs(email, password) {
    firebase.auth().signInWithEmailAndPassword(email, password)
      .then(() => {
        sessionStorage.setItem("username", email); // Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…
        window.location.href = "home.html"; // ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
      })
      .catch(error => {
        alert("âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + error.message);
      });
  }

  function loadAll() {
    loadUsers();
    loadVideos();
    loadImages();
    loadTexts();
    loadBoys();
    updateNotifications();
  }

  loadAll();
</script>
</body>
</html>
