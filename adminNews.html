<!doctype html>
<html lang="ar" dir="rtl">
<head><script type="text/javascript" src="/___vscode_livepreview_injected_script"></script>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</title>
    <link rel="icon" type="image/png" href="https://omartamer.netlify.app/ØµÙˆØ±Ø© Ø²Ø¹ÙŠÙ… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            direction: rtl;
            background: #f0f0f0;
            margin: 0;
            padding: 0;
        }
        .topbar {
            background: #1e3799;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logout-btn, button {
            background: #e74c3c;
            border: none;
            padding: 5px 10px;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 5px; /* Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        }
        .section {
            margin: 20px;
        }
        #videoContainer, #imageContainer, #textContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }
        .box {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .box video, .box img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
        }
        /* ØªØµÙ…ÙŠÙ… Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¹Ø·Ù„Ø© */
        .box.inactive-item video, .box.inactive-item img {
            filter: grayscale(100%) opacity(0.7);
            cursor: default !important;
        }
        .box.inactive-item {
            opacity: 0.6;
        }

        /* âœ… Modal Ù…Ø´ØªØ±Ùƒ */
        #mediaModal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }
        #mediaModal video, #mediaModal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0 0 20px #000;
        }
        #mediaModal span {
            position: absolute;
            top: 20px; right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }
    </style>
</head>
<body oncontextmenu="return false;">
<div class="topbar">
    <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
</div>

<div class="section">
    <h1>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</h1>
    <input type="file" id="videoFile" accept="video/*">
    <input type="text" id="videoName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
    <button onclick="uploadVideo()">Ø±ÙØ¹</button>
</div>
<div id="videoContainer" class="section"></div>

<div class="section">
    <h1>Ø±ÙØ¹ ØµÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø©</h1>
    <input type="file" id="imageFile" accept="image/*" multiple>
    <input type="text" id="imageName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ù„Ø¨ÙˆÙ… Ø£Ùˆ Ø§Ù„ØµÙˆØ±">
    <button onclick="uploadImages()">Ø±ÙØ¹</button>
</div>
<div id="imageContainer" class="section"></div>

<div id="mediaModal">
    <span onclick="closeModal()">&times;</span>
    <video id="modalVideo" controls style="display:none;"></video>
    <img id="modalImg" src="" style="display:none;">
</div>

<div class="section">
    <h1>Ø¥Ø¶Ø§ÙØ© Ù†Øµ</h1>
    <textarea id="textContent" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea>
    <button onclick="uploadText()">Ø­ÙØ¸ Ø§Ù„Ù†Øµ</button>
</div>
<div id="textContainer" class="section"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCN9vN9zcPa6OCUnzin101OTtyOYBDSPEk",
        authDomain: "bluetooth-4791f.firebaseapp.com",
        projectId: "bluetooth-4791f",
        storageBucket: "bluetooth-4791f.firebasestorage.app",
        messagingSenderId: "80129288547",
        appId: "1:80129288547:web:05c480484ba5eb1b908b56",
        measurementId: "G-51VB9VFYFJ"
    };
    firebase.initializeApp(firebaseConfig);

    const db = firebase.firestore();
    const cloudName = "dquoqajno";
    const uploadPreset = "public_upload";

    // ---------------------------------------------
    // 1. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±ÙØ¹ (Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© isActive: true)
    // ---------------------------------------------
    function uploadMedia(file, name, mediaType, collectionName, callback) {
        let formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", uploadPreset);

        fetch(`https://api.cloudinary.com/v1_1/${cloudName}/${mediaType}/upload`, {
            method: "POST",
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            db.collection(collectionName).add({
                name: name,
                url: data.secure_url,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                // âœ… Ø¥Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
                isActive: true
            }).then(callback).catch(e => console.error("Error adding doc:", e));
        }).catch(e => console.error("Error uploading to Cloudinary:", e));
    }

    function uploadVideo() {
        let file = document.getElementById("videoFile").files[0];
        let name = document.getElementById("videoName").value.trim();
        if (!file || !name) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        uploadMedia(file, name, "video", "videos", loadVideos);
    }

    function uploadImages() {
        let files = document.getElementById("imageFile").files;
        let name = document.getElementById("imageName").value.trim() || "ØµÙˆØ±Ø©";
        if (files.length === 0) return alert("Ø§Ø®ØªØ± ØµÙˆØ±");
        Array.from(files).forEach((file, i) => {
            uploadMedia(file, `${name} ${i+1}`, "image", "images", loadImages);
        });
    }

    function uploadText() {
        let content = document.getElementById("textContent").value.trim();
        if (!content) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ");
        db.collection("texts").add({
            content: content,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            // âœ… Ø¥Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            isActive: true
        }).then(() => {
            document.getElementById("textContent").value = "";
            loadTexts();
        }).catch(e => console.error("Error adding text:", e));
    }

    // ---------------------------------------------
    // 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Toggle Function)
    // ---------------------------------------------
    function toggleActiveStatus(collection, id, currentStatus, callback) {
        const newStatus = !currentStatus;
        db.collection(collection).doc(id).update({
            isActive: newStatus
        }).then(() => {
            alert(`ØªÙ… ${newStatus ? 'ØªÙØ¹ÙŠÙ„' : 'ØªØ¹Ø·ÙŠÙ„'} Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!`);
            callback();
        }).catch(error => {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«:", error);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«.");
        });
    }

    // ---------------------------------------------
    // 3. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø°Ù
    // ---------------------------------------------
    function deleteImage(id) {
        if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) {
            db.collection("images").doc(id).delete().then(loadImages).catch(e => console.error("Error deleting image:", e));
        }
    }

    function deleteItem(collection, id, callback) {
        if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) {
            db.collection(collection).doc(id).delete().then(callback).catch(e => console.error("Error deleting item:", e));
        }
    }
    
    // ---------------------------------------------
    // 4. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø¹Ø±Ø¶ (Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† isActive)
    // ---------------------------------------------

    function loadVideos() {
        let container = document.getElementById("videoContainer");
        container.innerHTML = "";
        db.collection("videos").orderBy("timestamp","desc").get().then(snap=>{
            if(snap.empty){container.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</p>";return;}
            snap.forEach(doc=>{
                let d = doc.data();
                // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
                const isActive = d.isActive === true; 
                const statusText = isActive ? 'Ù…ÙÙØ¹Ù‘ÙÙ„' : 'Ù…ÙØ¹Ø·Ù‘ÙÙ„';
                const actionText = isActive ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„';
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù‘Ù„Ø§Ù‹)
                const videoElement = isActive ? 
                    `<video src="${d.url}" onclick="openModal('${d.url}','video')"></video>` : 
                    `<video src="${d.url}"></video>`; // Ø¨Ø¯ÙˆÙ† onclick
                
                const boxClass = isActive ? 'box' : 'box inactive-item';

                container.innerHTML += `
                    <div class="${boxClass}">
                        ${videoElement}
                        <p>${d.name} (<span style="color:${isActive?'green':'red'}">${statusText}</span>)</p>
                        <button onclick="toggleActiveStatus('videos','${doc.id}',${isActive},loadVideos)">ğŸ”„ ${actionText}</button>
                        <button onclick="deleteItem('videos','${doc.id}',loadVideos)">âŒ Ø­Ø°Ù</button>
                    </div>`;
            });
        }).catch(e => console.error("Error loading videos:", e));
    }

    function loadImages() {
        let container = document.getElementById("imageContainer");
        container.innerHTML = "";
        db.collection("images").orderBy("timestamp","desc").get().then(snap=>{
            if(snap.empty){container.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±</p>";return;}
            snap.forEach(doc=>{
                let d = doc.data();
                // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
                const isActive = d.isActive === true; 
                const statusText = isActive ? 'Ù…ÙÙØ¹Ù‘ÙÙ„Ø©' : 'Ù…ÙØ¹Ø·Ù‘ÙÙ„Ø©';
                const actionText = isActive ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„';
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù‘Ù„Ø§Ù‹)
                const imageElement = isActive ? 
                    `<img src="${d.url}" alt="${d.name}" onclick="openModal('${d.url}','image')">` : 
                    `<img src="${d.url}" alt="${d.name}">`; // Ø¨Ø¯ÙˆÙ† onclick

                const boxClass = isActive ? 'box' : 'box inactive-item';

                container.innerHTML += `
                    <div class="${boxClass}">
                        ${imageElement}
                        <p>${d.name} (<span style="color:${isActive?'green':'red'}">${statusText}</span>)</p>
                        <button onclick="toggleActiveStatus('images','${doc.id}',${isActive},loadImages)">ğŸ”„ ${actionText}</button>
                        <button onclick="deleteImage('${doc.id}')">âŒ Ø­Ø°Ù</button>
                    </div>`;
            });
        }).catch(e => console.error("Error loading images:", e));
    }

    function loadTexts() {
        let container = document.getElementById("textContainer");
        container.innerHTML = "";
        db.collection("texts").orderBy("timestamp","desc").get().then(snap=>{
            if(snap.empty){container.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØµÙˆØµ</p>";return;}
            snap.forEach(doc=>{
                let d = doc.data();
                // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
                const isActive = d.isActive === true; 
                const statusText = isActive ? 'Ù…ÙÙØ¹Ù‘ÙÙ„' : 'Ù…ÙØ¹Ø·Ù‘ÙÙ„';
                const actionText = isActive ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„';

                let content = d.content;
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¥Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…ÙØ¹Ù‘Ù„Ø§Ù‹
                if (isActive) {
                    content = d.content.replace(/(https?:\/\/[^\s]+)/g,
                        url => `<a href="${url}" target="_blank">ğŸ”— ${url}</a>`);
                }

                const boxClass = isActive ? 'box' : 'box inactive-item';

                container.innerHTML += `
                    <div class="${boxClass}">
                        <div style="white-space:pre-wrap;">${content}</div>
                        <p>Ø§Ù„Ø­Ø§Ù„Ø©: (<span style="color:${isActive?'green':'red'}">${statusText}</span>)</p>
                        <button onclick="toggleActiveStatus('texts','${doc.id}',${isActive},loadTexts)">ğŸ”„ ${actionText}</button>
                        <button onclick="deleteItem('texts','${doc.id}',loadTexts)">âŒ Ø­Ø°Ù</button>
                    </div>`;
            });
        }).catch(e => console.error("Error loading texts:", e));
    }

    // ---------------------------------------------
    // 5. ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ©
    // ---------------------------------------------

    /* âœ… ÙØªØ­ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
    function openModal(url, type="image") {
        const modal = document.getElementById("mediaModal");
        const img = document.getElementById("modalImg");
        const video = document.getElementById("modalVideo");
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù†ØµØ± Ù…ÙØ¹Ù‘Ù„ Ù‚Ø¨Ù„ Ø§Ù„ÙØªØ­
        // ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ…ÙŠÙ…ØŒ Ù„Ù† ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ openModal Ø¥Ù„Ø§ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ø´Ø·Ø© ÙÙŠ load functions
        
        if(type === "image"){
            img.src = url;
            img.style.display = "block";
            video.style.display = "none";
        } else {
            video.src = url;
            video.style.display = "block";
            img.style.display = "none";
        }
        modal.style.display = "flex";
    }

    function closeModal() {
        const modal = document.getElementById("mediaModal");
        const video = document.getElementById("modalVideo");
        modal.style.display = "none";
        video.pause(); 
    }

    function loadAll(){
        loadVideos();
        loadImages();
        loadTexts();
    }

    window.onload=loadAll;
</script>
</body>
</html>
