<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</title>
<link rel="icon" type="image/png" href="https://omartamer.netlify.app/ØµÙˆØ±Ø© Ø²Ø¹ÙŠÙ… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©.png">
<link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<style>
body {
  font-family: 'Cairo', sans-serif;
  direction: rtl;
  background: #f0f0f0;
  margin: 0;
  padding: 0;
}
.topbar {
  background: #1e3799;
  color: white;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.logout-btn, button {
  background: #e74c3c;
  border: none;
  padding: 5px 10px;
  color: white;
  border-radius: 4px;
  cursor: pointer;
}
.section {
  margin: 20px;
}
#videoContainer, #imageContainer {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 10px;
}
.box video, 
.box img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 5px;
  cursor: pointer;
}
/* âœ… Modal Ù…Ø´ØªØ±Ùƒ */
#mediaModal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
}
#mediaModal video, 
#mediaModal img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 10px;
  box-shadow: 0 0 20px #000;
}
#mediaModal span {
  position: absolute;
  top: 20px; right: 30px;
  color: white;
  font-size: 40px;
  cursor: pointer;
}
</style>
</head>
<body oncontextmenu="return false;">
<div class="topbar">
  <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
</div>

<div class="section">
  <h1>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</h1>
  <input type="file" id="videoFile" accept="video/*">
  <input type="text" id="videoName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
  <button onclick="uploadVideo()">Ø±ÙØ¹</button>
</div>
<div id="videoContainer" class="section"></div>

<div class="section">
  <h1>Ø±ÙØ¹ ØµÙˆØ± Ù…ØªØ¹Ø¯Ø¯Ø©</h1>
  <input type="file" id="imageFile" accept="image/*" multiple>
  <input type="text" id="imageName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ù„Ø¨ÙˆÙ… Ø£Ùˆ Ø§Ù„ØµÙˆØ±">
  <button onclick="uploadImages()">Ø±ÙØ¹</button>
</div>
<div id="imageContainer" class="section"></div>

<!-- âœ… Modal ÙˆØ§Ø­Ø¯ Ù„Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆ -->
<div id="mediaModal">
  <span onclick="closeModal()">&times;</span>
  <video id="modalVideo" controls style="display:none;"></video>
  <img id="modalImg" src="" style="display:none;">
</div>

<div class="section">
  <h1>Ø¥Ø¶Ø§ÙØ© Ù†Øµ</h1>
  <textarea id="textContent" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea>
  <button onclick="uploadText()">Ø­ÙØ¸ Ø§Ù„Ù†Øµ</button>
</div>
<div id="textContainer" class="section"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCN9vN9zcPa6OCUnzin101OTtyOYBDSPEk",
  authDomain: "bluetooth-4791f.firebaseapp.com",
  projectId: "bluetooth-4791f",
  storageBucket: "bluetooth-4791f.firebasestorage.app",
  messagingSenderId: "80129288547",
  appId: "1:80129288547:web:05c480484ba5eb1b908b56",
  measurementId: "G-51VB9VFYFJ"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const cloudName = "dquoqajno";
const uploadPreset = "public_upload";

function uploadMedia(file, name, mediaType, collectionName, callback) {
  let formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", uploadPreset);
  fetch(`https://api.cloudinary.com/v1_1/${cloudName}/${mediaType}/upload`, {
      method: "POST",
      body: formData
  })
  .then(res => res.json())
  .then(data => {
    db.collection(collectionName).add({
      name: name,
      url: data.secure_url,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(callback);
  });
}

function uploadVideo() {
  let file = document.getElementById("videoFile").files[0];
  let name = document.getElementById("videoName").value.trim();
  if (!file || !name) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
  uploadMedia(file, name, "video", "videos", loadVideos);
}

function uploadImages() {
  let files = document.getElementById("imageFile").files;
  let name = document.getElementById("imageName").value.trim() || "ØµÙˆØ±Ø©";
  if (files.length === 0) return alert("Ø§Ø®ØªØ± ØµÙˆØ±");
  Array.from(files).forEach((file, i) => {
    uploadMedia(file, `${name} ${i+1}`, "image", "images", loadImages);
  });
}

function deleteImage(id) {
  if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) {
    db.collection("images").doc(id).delete().then(loadImages);
  }
}

/* âœ… ÙØªØ­ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
function openModal(url, type="image") {
  const modal = document.getElementById("mediaModal");
  const img = document.getElementById("modalImg");
  const video = document.getElementById("modalVideo");

  if(type === "image"){
    img.src = url;
    img.style.display = "block";
    video.style.display = "none";
  } else {
    video.src = url;
    video.style.display = "block";
    img.style.display = "none";
  }

  modal.style.display = "flex";
}

function closeModal() {
  const modal = document.getElementById("mediaModal");
  const video = document.getElementById("modalVideo");
  modal.style.display = "none";
  video.pause(); 
}

function uploadText() {
  let content = document.getElementById("textContent").value.trim();
  if (!content) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ");
  db.collection("texts").add({
    content: content,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    document.getElementById("textContent").value = "";
    loadTexts();
  });
}

function deleteItem(collection, id, callback) {
  if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) {
    db.collection(collection).doc(id).delete().then(callback);
  }
}

function loadVideos() {
  let container = document.getElementById("videoContainer");
  container.innerHTML = "";
  db.collection("videos").orderBy("timestamp","desc").get().then(snap=>{
    if(snap.empty){container.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</p>";return;}
    snap.forEach(doc=>{
      let d = doc.data();
      container.innerHTML += `
        <div class="box">
          <video src="${d.url}" onclick="openModal('${d.url}','video')"></video>
          <p>${d.name}</p>
          <button onclick="deleteItem('videos','${doc.id}',loadVideos)">âŒ Ø­Ø°Ù</button>
        </div>`;
    });
  });
}

function loadImages() {
  let container = document.getElementById("imageContainer");
  container.innerHTML = "";
  db.collection("images").orderBy("timestamp","desc").get().then(snap=>{
    if(snap.empty){container.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±</p>";return;}
    snap.forEach(doc=>{
      let d = doc.data();
      container.innerHTML += `
        <div class="box">
          <img src="${d.url}" alt="${d.name}" onclick="openModal('${d.url}','image')">
          <p>${d.name}</p>
          <button onclick="deleteImage('${doc.id}')">âŒ Ø­Ø°Ù</button>
        </div>`;
    });
  });
}

function loadTexts() {
  let container = document.getElementById("textContainer");
  container.innerHTML = "";
  db.collection("texts").orderBy("timestamp","desc").get().then(snap=>{
    if(snap.empty){container.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØµÙˆØµ</p>";return;}
    snap.forEach(doc=>{
      let d = doc.data();
      let content = d.content.replace(/(https?:\/\/[^\s]+)/g,
        url => `<a href="${url}" target="_blank">ğŸ”— ${url}</a>`);
      container.innerHTML += `
        <div class="box">
          <div style="white-space:pre-wrap;">${content}</div>
          <button onclick="deleteItem('texts','${doc.id}',loadTexts)">âŒ Ø­Ø°Ù</button>
        </div>`;
    });
  });
}

function loadAll(){loadVideos();loadImages();loadTexts();}
window.onload=loadAll;
</script>
</body>
</html>
