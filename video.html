<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØµÙØ­Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</title>
        <link rel="icon" type="image/png" href="https://omartamer.netlify.app/ØµÙˆØ±Ø© Ø²Ø¹ÙŠÙ… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
  <style>
.desktop-header a:hover::after,img,video{width:100%}body{margin:0;font-family:Cairo,sans-serif;background:#f4f6f8;padding-bottom:100px}.desktop-header,.main-header{background-color:#2c3e50;color:#fff;padding:15px 20px;font-weight:700;font-size:18px}.desktop-header{display:flex;justify-content:space-between;align-items:center}.desktop-header a,.mobile-footer .notif-icon,.mobile-footer a,.notif-icon{color:#fff;text-decoration:none;margin-right:10px;position:relative;cursor:pointer;font-size:16px!important}.notif-num{background:red;color:#fff;border-radius:50%;font-size:12px;padding:2px 6px;position:absolute;top:-6px;right:-10px}.mobile-footer{display:none}.desktop-header a::after{content:'';position:absolute;bottom:-3px;right:0;width:0;height:2px;background-color:#fff;transition:width .3s}@media (max-width:768px){.desktop-header{display:none}.main-header{text-align:center}.mobile-footer{display:flex;justify-content:center;gap:15px;position:fixed;bottom:0;width:100%;background-color:#2c3e50;color:#fff;padding:10px 0;z-index:1000}}.content{padding:20px}h2,h3{text-align:center;color:#1e3799}.media-box{background:#fff;padding:15px;margin:20px auto;max-width:700px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1)}img,video{border-radius:8px;margin-top:10px}.text-content{font-size:16px;background-color:#f9f9f9;padding:15px;border-radius:8px;white-space:pre-wrap}.timestamp{font-size:13px;color:#888;margin-top:8px}.media-box:hover{transform:scale(1.03);box-shadow:0 6px 20px rgba(0,0,0,.15)}
.highlighted {
  border: 3px solid #3498db !important;
  box-shadow: 0 0 15px #2980b9 !important;
  position: relative;
}

.highlighted .close-btn {
  display: block;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #e74c3c;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 4px 8px;
  cursor: pointer;
  display: none;
  z-index: 10;
}
.highlighted .close-btn:hover {
  background: #c0392b;  
    box-shadow: 0 0 10px rgba(192, 57, 43, 0.5);
}
  </style>
</head>
<body>


<header class="desktop-header">
  <div>
    <span class="notif-icon" onclick="markNotificationsSeen()">ğŸ””
      <span id="notifCount" class="notif-num" style="display:none;">0</span>
    </span>
          <a href="ØªØ¹Ù„ÙŠÙ‚Ø§Øª.html">ØªØ¹Ù„ÙŠÙ‚Ø§Øª</a>
    <a href="ØªÙˆØ§ØµÙ„.html">ØªÙˆØ§ØµÙ„</a>
    <a href="video.html">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</a>
    <a href="home.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  </div>
  <div>Ø£Ù‡Ù„Ø§Ù‹ ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ø¹Ù…Ø± ØªØ§Ù…Ø± Ù…Ø­Ù…Ø¯
</div>
</header>

<div class="content">
  <h2 id="greeting">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h2>

  <h3>Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h3>
  <div id="videoContainer"></div>

  <h3>Ø§Ù„ØµÙˆØ±</h3>
  <div id="imageContainer"></div>

  <h3>Ø§Ù„Ù†ØµÙˆØµ</h3>
  <div id="textContainer"></div>
</div>

<header class="mobile-footer">
  <span class="notif-icon" onclick="markNotificationsSeen()">ğŸ””
    <span id="notifCountMobile" class="notif-num" style="display:none;">0</span>
  </span>
        <a href="ØªØ¹Ù„ÙŠÙ‚Ø§Øª.html">ØªØ¹Ù„ÙŠÙ‚Ø§Øª</a>
  <a href="video.html">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</a>
  <a href="home.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
</header>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTyEZBO2U2UTWl-DJuJgYrS0oiKEDr6Jw",
  authDomain: "ahmed-saeed-669ab.firebaseapp.com",
  projectId: "ahmed-saeed-669ab"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const username = sessionStorage.getItem("username") || "Ø²Ø§Ø¦Ø±";

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
function formatTimestamp(e) {
  if (!e) return "";
  let t = e.toDate();
  return `${t.toLocaleDateString()} - ${t.toLocaleTimeString()}`;
}

// Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
function checkNewNotifications() {
  let e = 0;
  Promise.all(["videos", "images", "texts"].map(t =>
    db.collection(t).get().then(t => {
      t.forEach(t => {
        let n = t.data();
        (!n.seenBy || !n.seenBy.includes(username)) && e++;
      });
    })
  )).then(() => {
    document.getElementById("notifCount").textContent = e;
    document.getElementById("notifCountMobile").textContent = e;
    let t = e > 0 ? "inline-block" : "none";
    document.getElementById("notifCount").style.display = t;
    document.getElementById("notifCountMobile").style.display = t;
  });
}

function markNotificationsSeen() {
  ["videos", "images", "texts"].forEach(e => {
    db.collection(e).get().then(t => {
      t.forEach(t => {
        let n = t.data();
        if (!n.seenBy || !n.seenBy.includes(username)) {
          let a = n.seenBy || [];
          a.push(username);
          db.collection(e).doc(t.id).update({ seenBy: a });
        }
      });
    });
  });
  document.getElementById("notifCount").style.display = "none";
  document.getElementById("notifCountMobile").style.display = "none";
}

// âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ø¹ Ø²Ø± Ø§Ù„Ø´ÙŠØ±
function loadVideos() {
  let container = document.getElementById("videoContainer");
  container.innerHTML = "";
  db.collection("videos")
    .orderBy("timestamp", "desc")
    .get()
    .then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        let data = doc.data();
        let videoId = `video_${doc.id}`;
        let pageUrl = `${window.location.origin}${window.location.pathname}#${videoId}`;

        let box = document.createElement("div");
        box.className = "media-box";
        box.id = videoId;
        box.style.position = "relative";

        box.innerHTML = `
  <h4>${data.name}</h4>

  <video controls style="width: 100%; max-height: 70vh;">
    <source src="${data.url}" type="video/mp4">
    Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
  </video>

  <p class="timestamp">ğŸ“… ${formatTimestamp(data.timestamp)}</p>

<button onclick="copyLink('video', '${doc.id}', this)">
  style="margin-top:10px;background:#2980b9;color:#fff;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;">
  ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©
</button>

`;
          

        container.appendChild(box);
      });

      // Ù„Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‡Ø§Ø´ Ù„ÙÙŠØ¯ÙŠÙˆØŒ Ø§Ù†Ø²Ù„ Ù„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
      if (location.hash) {
  let target = document.querySelector(location.hash);
  if (target) {
    target.classList.add("highlighted");

    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯
    if (!target.querySelector(".close-btn")) {
      const closeBtn = document.createElement("button");
      closeBtn.className = "close-btn";
      closeBtn.innerText = "âŒ";
      closeBtn.onclick = () => target.style.display = "none";
      target.appendChild(closeBtn);
    }

    target.scrollIntoView({ behavior: "smooth", block: "center" });
  }
}
    });
}




// Ø²Ø± Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
// Ø²Ø± Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
// âœ… ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© copyLink Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ Ù„ØµÙØ­Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù†ÙØµÙ„Ø©
// âœ… ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© copyLink Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ Ù„ØµÙØ­Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù†ÙØµÙ„Ø©
function copyLink(type, docId, btn) {
  let prefix = "";

  if (type === "video") prefix = "video_";
  if (type === "img") prefix = "img_";
  if (type === "text") prefix = "text_";

  const newLink = `https://omartamer.netlify.app/single_video#${prefix}${docId}`;

  navigator.clipboard.writeText(newLink).then(() => {
    btn.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®";
    setTimeout(() => {
      btn.innerText = "ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©";
    }, 2000);
  });
}

// Ø§Ù„ØµÙˆØ±
function loadImages() {
  let container = document.getElementById("imageContainer");
  container.innerHTML = "";
  db.collection("images")
    .orderBy("timestamp", "desc")
    .get()
    .then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        let data = doc.data();
        let imageId = `image_${doc.id}`;
        let pageUrl = `${window.location.origin}${window.location.pathname}#${imageId}`;

        let box = document.createElement("div");
        box.className = "media-box";
        box.id = imageId;
        box.innerHTML = `
          <h4>${data.name}</h4>
          <img src="${data.url}" alt="${data.name}" style="width: 100%; max-height: 70vh; border-radius: 8px;">
          <p class="timestamp">ğŸ“… ${formatTimestamp(data.timestamp)}</p>
          <button onclick="copyLink('img', '${doc.id}', this)">
style="margin-top:10px;background:#2980b9;color:#fff;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;">
  ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©
</button>

         
        `;
        container.appendChild(box);
      });

      if (location.hash) {
        let target = document.querySelector(location.hash);
        if (target) {
          target.scrollIntoView({ behavior: "smooth" });
        }
      }
    });
}





// Ø§Ù„Ù†ØµÙˆØµ
function loadTexts() {
  let container = document.getElementById("textContainer");
  container.innerHTML = "";
  db.collection("texts")
    .orderBy("timestamp", "desc")
    .get()
    .then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        let data = doc.data();
        let textId = `text_${doc.id}`;
        let pageUrl = `${window.location.origin}${window.location.pathname}#${textId}`;

        let box = document.createElement("div");
        box.className = "media-box";
        box.id = textId;
        box.innerHTML = `
          <div class="text-content">${data.content}</div>
          <p class="timestamp">ğŸ“… ${formatTimestamp(data.timestamp)}</p>
          <button onclick="copyLink('text', '${doc.id}', this)">
            style="margin-top:10px;background:#2980b9;color:#fff;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;">
  ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©
</button>

        `;
        container.appendChild(box);
      });

      if (location.hash) {
        let target = document.querySelector(location.hash);
        if (target) {
          target.scrollIntoView({ behavior: "smooth" });
        }
      }
    });
}

function highlightIfAnchorExists() {
  const hash = location.hash;
  if (hash) {
    const target = document.querySelector(hash);
    if (target) {
      target.classList.add("highlighted");

      // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ø¥Ø°Ø§ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
      if (!target.querySelector('.close-btn')) {
        const closeBtn = document.createElement('button');
        closeBtn.className = 'close-btn';
        closeBtn.innerText = 'âŒ';
        closeBtn.onclick = () => target.style.display = 'none';
        target.appendChild(closeBtn);
      }

      target.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }
}



// ØªØ±Ø­ÙŠØ¨ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„
document.getElementById("greeting").textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${username}!`;
loadVideos();
loadImages();
loadTexts();
checkNewNotifications();
setTimeout(() => {
  highlightIfAnchorExists();
}, 1000);
</script>

</body>
</html>
