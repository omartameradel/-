<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>لوحة تحكم جـنى عـطيه</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    body {
      background: #121212;
      color: white;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      padding: 20px;
      font-size: 1.8rem;
      font-weight: bold;
      background: #6a11cb;
      border-radius: 15px;
      margin-bottom: 20px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    header h1 {
      margin: 0;
    }
    .lang-switch {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 50px;
      cursor: pointer;
      font-weight: bold;
    }
    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    input, button, textarea {
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      border: none;
      border-radius: 10px;
    }
    input, textarea {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    .btn {
      padding: 12px;
      border: none;
      border-radius: 50px;
      background: #ff2a6d;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .btn:hover {
      transform: scale(1.05);
    }
    .btn-secondary {
      background: #3498db;
    }
    .art-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    .logout-btn {
      background: #e74c3c;
    }
    .tab-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tab-buttons button {
      flex: 1;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 10px;
    }
    .tab-buttons button.active {
      background: #6a11cb;
    }
    .img-preview {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 10px;
      margin: 10px 0;
    }
    .error-message {
      color: #e74c3c;
      text-align: center;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="admin-title">لوحة تحكم جـنى عـطيه</h1>
    <button class="lang-switch" id="lang-btn" onclick="toggleLanguage()">EN</button>
  </header>

  <div class="container" id="admin-app">
    <!-- يتم تعبئته ديناميكيًا -->
  </div>

  <script>
    // تحميل اللغة
    let lang = localStorage.getItem('app-lang') || 'ar';

    // ترجمات
    const t = {
      ar: {
        loginTitle: 'تسجيل دخول المالك',
        username: 'اسم المستخدم',
        password: 'كلمة المرور',
        login: 'تسجيل الدخول',
        back: 'العودة للرئيسية',
        artworks: 'اللوحات',
        poetry: 'الشعر',
        logout: 'تسجيل الخروج',
        addArt: 'إضافة لوحة جديدة',
        title: 'عنوان اللوحة',
        price: 'السعر (ج.م)',
        image: 'رابط الصورة',
        category: 'الفئة',
        digital: 'الفن الرقمي',
        customized: 'الفن المخصص',
        description: 'الوصف',
        add: 'إضافة اللوحة',
        current: 'اللوحات الحالية',
        delete: 'حذف',
        addPoem: 'إضافة قصيدة جديدة',
        poemTitle: 'عنوان القصيدة',
        poemContent: 'محتوى القصيدة',
        addPoemBtn: 'إضافة القصيدة',
        poemsCurrent: 'القصائد الحالية',
        confirmDelete: 'هل تريد حذف هذه القصيدة؟',
        loginFailed: 'خطأ في اسم المستخدم أو كلمة المرور',
        artworkAdded: 'تمت إضافة اللوحة!',
        artworkDeleted: 'تم الحذف',
        poemAdded: 'تمت إضافة القصيدة!',
        poemDeleted: 'تم الحذف'
      },
      en: {
        loginTitle: 'Admin Login',
        username: 'Username',
        password: 'Password',
        login: 'Login',
        back: 'Back to Home',
        artworks: 'Artworks',
        poetry: 'Poetry',
        logout: 'Logout',
        addArt: 'Add New Artwork',
        title: 'Artwork Title',
        price: 'Price (EGP)',
        image: 'Image URL',
        category: 'Category',
        digital: 'Digital Art',
        customized: 'Customized Art',
        description: 'Description',
        add: 'Add Artwork',
        current: 'Current Artworks',
        delete: 'Delete',
        addPoem: 'Add New Poem',
        poemTitle: 'Poem Title',
        poemContent: 'Poem Content',
        addPoemBtn: 'Add Poem',
        poemsCurrent: 'Current Poems',
        confirmDelete: 'Are you sure you want to delete this poem?',
        loginFailed: 'Invalid username or password',
        artworkAdded: 'Artwork added!',
        artworkDeleted: 'Deleted successfully',
        poemAdded: 'Poem added!',
        poemDeleted: 'Deleted successfully'
      }
    };

    function updateTexts() {
      document.getElementById('admin-title').textContent = lang === 'ar' ? 'لوحة تحكم جـنى عـطيه' : 'Jana Attia Admin Panel';
      document.getElementById('lang-btn').textContent = lang === 'ar' ? 'EN' : 'AR';
    }

    function toggleLanguage() {
      lang = lang === 'ar' ? 'en' : 'ar';
      localStorage.setItem('app-lang', lang);
      location.reload();
    }

    // --- إصلاح زر العودة ---
    function goBackSafely() {
      // الطريقة 1: العودة إلى الصفحة السابقة
      if (window.history.length > 1) {
        window.history.back();
      } else {
        // الطريقة 2: التوجيه المباشر
        window.location.href = 'index.html';
      }
    }

    // بيانات الدخول
    const ADMIN_USER = "janaattia@123";
    const ADMIN_PASS = "jana123";

    // تحقق من تسجيل الدخول
    function checkAuth() {
      const isLoggedIn = localStorage.getItem('admin_logged_in') === 'true';
      if (!isLoggedIn) {
        showLogin();
      } else {
        showAdminPanel();
      }
    }

    // عرض نموذج الدخول
    function showLogin() {
      const app = document.getElementById('admin-app');
      if (!app) {
        document.body.innerHTML = `
          <div class="error-message">
            خطأ في تحميل الصفحة. <br>
            <button onclick="goBackSafely()" class="btn">العودة للرئيسية</button>
          </div>
        `;
        return;
      }

      app.innerHTML = `
        <div class="card" style="max-width: 420px; margin: 50px auto; text-align: center;">
          <h2 style="margin-bottom: 20px;">🔐 ${t[lang].loginTitle}</h2>
          <form onsubmit="event.preventDefault(); login();">
            <input type="text" id="username" placeholder="${t[lang].username}" required />
            <input type="password" id="password" placeholder="${t[lang].password}" required />
            <button type="submit" class="btn" style="width: 100%; margin: 15px 0;">
              ${t[lang].login}
            </button>
          </form>
          <button onclick="goBackSafely()" class="btn btn-secondary" style="width: 100%;">
            ← ${t[lang].back}
          </button>
        </div>
      `;
      updateTexts();
    }

    // تسجيل الدخول
    function login() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      if (username === ADMIN_USER && password === ADMIN_PASS) {
        localStorage.setItem('admin_logged_in', 'true');
        showAdminPanel();
      } else {
        alert(t[lang].loginFailed);
      }
    }

    // تسجيل الخروج
    function logout() {
      localStorage.removeItem('admin_logged_in');
      location.reload();
    }

    // لوحة التحكم
    function showAdminPanel() {
      const artworks = JSON.parse(localStorage.getItem('artworks')) || [];
      const poems = JSON.parse(localStorage.getItem('poems')) || [];
      let activeTab = "artworks";

      renderTabs();

      function renderTabs() {
        const app = document.getElementById('admin-app');
        if (!app) return;

        app.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="tab-buttons">
              <button class="${activeTab === 'artworks' ? 'active' : ''}" onclick="changeTab('artworks')">${t[lang].artworks}</button>
              <button class="${activeTab === 'poems' ? 'active' : ''}" onclick="changeTab('poems')">${t[lang].poetry}</button>
            </div>
            <button onclick="logout()" class="btn logout-btn">${t[lang].logout}</button>
          </div>
        ` + (activeTab === 'artworks' ? renderArtworksTab() : renderPoemsTab());
        updateTexts();
      }

      function renderArtworksTab() {
        let html = `
          <div class="card">
            <h3>${t[lang].addArt}</h3>
            <input type="text" id="new-title" placeholder="${t[lang].title}" />
            <input type="number" id="new-price" placeholder="${t[lang].price}" />
            <input type="url" id="new-image" placeholder="${t[lang].image}" value="https://source.unsplash.com/random/300x400/?art" />
            <select id="new-category">
              <option value="الفن الرقمي">${t[lang].digital}</option>
              <option value="الفن المخصص">${t[lang].customized}</option>
            </select>
            <textarea id="new-description" placeholder="${t[lang].description}" rows="2"></textarea>
            <button onclick="addArtwork()" class="btn">${t[lang].add}</button>
          </div>

          <h3 style="margin: 20px 0;">${t[lang].current} (${artworks.length})</h3>
          <div class="art-grid">
        `;
        artworks.forEach(art => {
          html += `
            <div class="card">
              <img src="${art.image}" alt="${art.title}" class="img-preview" />
              <h3>${art.title}</h3>
              <p>${art.category}</p>
              <p><strong>${art.price} ج.م</strong></p>
              <button onclick="deleteArtwork(${art.id})" class="btn" style="background: #e74c3c;">
                ${t[lang].delete}
              </button>
            </div>
          `;
        });
        html += `</div>`;
        return html;
      }

      function renderPoemsTab() {
        let html = `
          <div class="card">
            <h3>${t[lang].addPoem}</h3>
            <input type="text" id="new-poem-title" placeholder="${t[lang].poemTitle}" />
            <textarea id="new-poem-content" placeholder="${t[lang].poemContent}" rows="6"></textarea>
            <button onclick="addPoem()" class="btn">${t[lang].addPoemBtn}</button>
          </div>

          <h3 style="margin: 20px 0;">${t[lang].poemsCurrent} (${poems.length})</h3>
        `;
        poems.forEach(poem => {
          html += `
            <div class="card">
              <h3>${poem.title}</h3>
              <pre style="white-space: pre-line; margin: 10px 0; line-height: 2;">${poem.content}</pre>
              <button onclick="deletePoem(${poem.id})" class="btn" style="background: #e74c3c;">
                ${t[lang].delete}
              </button>
            </div>
          `;
        });
        return html;
      }

      window.changeTab = (tab) => {
        activeTab = tab;
        renderTabs();
      };

      window.addArtwork = () => {
        const title = document.getElementById("new-title").value;
        const price = document.getElementById("new-price").value;
        const image = document.getElementById("new-image").value;
        const category = document.getElementById("new-category").value;
        const description = document.getElementById("new-description").value;

        if (!title || !price || !image) {
          alert("املأ جميع الحقول");
          return;
        }

        const artworks = JSON.parse(localStorage.getItem('artworks')) || [];
        const newArt = {
          id: Date.now(),
          title,
          price: parseFloat(price),
          image,
          category,
          description: description || "عمل فني جديد"
        };

        artworks.unshift(newArt);
        localStorage.setItem('artworks', JSON.stringify(artworks));
        alert(t[lang].artworkAdded);
        showAdminPanel();
      };

      window.addPoem = () => {
        const title = document.getElementById("new-poem-title").value;
        const content = document.getElementById("new-poem-content").value;

        if (!title || !content) {
          alert("املأ العنوان والمحتوى");
          return;
        }

        const poems = JSON.parse(localStorage.getItem('poems')) || [];
        const newPoem = {
          id: Date.now(),
          title,
          content
        };

        poems.unshift(newPoem);
        localStorage.setItem('poems', JSON.stringify(poems));
        alert(t[lang].poemAdded);
        showAdminPanel();
      };

      window.deleteArtwork = (id) => {
        if (confirm("هل تريد حذف هذه اللوحة؟")) {
          let artworks = JSON.parse(localStorage.getItem('artworks')) || [];
          artworks = artworks.filter(a => a.id !== id);
          localStorage.setItem('artworks', JSON.stringify(artworks));

          let cart = JSON.parse(localStorage.getItem('cart')) || [];
          cart = cart.filter(a => a.id !== id);
          localStorage.setItem('cart', JSON.stringify(cart));

          let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
          wishlist = wishlist.filter(a => a.id !== id);
          localStorage.setItem('wishlist', JSON.stringify(wishlist));

          alert(t[lang].artworkDeleted);
          showAdminPanel();
        }
      };

      window.deletePoem = (id) => {
        if (confirm(t[lang].confirmDelete)) {
          let poems = JSON.parse(localStorage.getItem('poems')) || [];
          poems = poems.filter(p => p.id !== id);
          localStorage.setItem('poems', JSON.stringify(poems));
          alert(t[lang].poemDeleted);
          showAdminPanel();
        }
      };
    }

    // تشغيل التحقق
    try {
      checkAuth();
    } catch (e) {
      console.error("خطأ في تحميل الصفحة:", e);
      document.getElementById('admin-app').innerHTML = `
        <div class="error-message">
          حدث خطأ في التحميل. <br>
          <button onclick="goBackSafely()" class="btn">العودة للرئيسية</button>
        </div>
      `;
    }
  </script>
</body>
</html>